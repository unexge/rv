{"id":"12ienxcq","parent_id":null,"name":"Create a testing harness for testing the TUI","description":"I'd like to add a testing harness to be able to perform complex tests on the TUI, like opening the diff, adding comments, moving to a different file etc. This harness will help us to build an extensive testing suite. I'd also like to have some form of snapshot testing where after performing some actions, I'd like to take a snapshot with all the current state, like syntax highlighting, selected file etc. and compare it with later runs to ensure there aren't any unintentional changes.\n\nUPDATE: The test harness has been implemented in src/test_harness.zig. It provides:\n- TestRunner: wraps UI for headless testing with configurable dimensions\n- Snapshot: captures text, styles, and UI state (mode, cursor, file, etc.)\n- serialize/deserialize: for storing and comparing snapshots\n- sendKey/sendChar: for simulating user input\n- compare: diffs two snapshots and reports differences\n\nRemaining work is to add comprehensive tests using the harness (see child tasks).","priority":1,"completed":false,"result":"Harness implemented in src/test_harness.zig","metadata":{"github":{"issueNumber":1,"issueUrl":"https://github.com/unexge/rv/issues/1","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T13:06:51.216Z","updated_at":"2026-01-31T21:23:44.877Z","started_at":"2026-01-31T20:00:00.000Z","completed_at":null,"blockedBy":[],"blocks":[],"children":["t1_cursor","t2_select","t3_modes","t4_comment","t5_views","t6_collapse","t7_filelist","t8_render","t9_edge","t10_integ"]}
{"id":"1z9fc6qo","parent_id":null,"name":"Summary view should collapse Zig test blocks","description":"","priority":1,"completed":false,"result":null,"metadata":{"github":{"issueNumber":5,"issueUrl":"https://github.com/unexge/rv/issues/5","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T20:58:39.823Z","updated_at":"2026-01-31T21:23:44.891Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"25l9nvmu","parent_id":null,"name":"Summary view on the diff","description":"I'd like to present a summary of the changes currently reviewed. Since agents can be verbose on generating code, I'd like to be able to present as much as semantic information in the summary view with the minimal bloat. Summary view should show how many files are changed, how many functions are changed in each file, how many new structs/classes are added etc. Summary view should also work a the file level and function/class/struct level as well, showing summary of what changed more granular level","priority":1,"completed":false,"result":null,"metadata":{"github":{"issueNumber":2,"issueUrl":"https://github.com/unexge/rv/issues/2","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T13:11:01.700Z","updated_at":"2026-01-31T21:23:44.892Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"93cxxhm8","parent_id":null,"name":"Ability to stage changes","description":"Currently, we can only add comments to reviewed lines, but we should be able to stage code blocks that look good and doesn't require any changes. That way, the operator can incrementally stage blocks to drain pending changes. Ideally there should be a new action \"Stage\" that can be used selected lines similar to \"Comment\" and \"Ask\"","priority":1,"completed":false,"result":null,"metadata":{"github":{"issueNumber":7,"issueUrl":"https://github.com/unexge/rv/issues/7","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T21:17:39.122Z","updated_at":"2026-01-31T21:23:44.894Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"fnx14a4f","parent_id":null,"name":"Show minimap on the file diff","description":"","priority":1,"completed":false,"result":null,"metadata":{"github":{"issueNumber":8,"issueUrl":"https://github.com/unexge/rv/issues/8","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T21:22:08.790Z","updated_at":"2026-01-31T21:23:44.895Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"rd4hy68p","parent_id":null,"name":"Ability to filter out cosmetic changes","description":"Since agents are good/bad at generating lots of cosmetic changes, and reviewers only care about semantic changes on the logic, I'd like to have a mode where rv tries to collapse cosmetic changes like code comments, variable renames, moving functions from one place to another etc.","priority":1,"completed":false,"result":null,"metadata":{"github":{"issueNumber":3,"issueUrl":"https://github.com/unexge/rv/issues/3","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T13:12:49.903Z","updated_at":"2026-01-31T21:23:44.896Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"sg1iw2mz","parent_id":null,"name":"Ability to review newly created files","description":"","priority":1,"completed":false,"result":null,"metadata":{"github":{"issueNumber":4,"issueUrl":"https://github.com/unexge/rv/issues/4","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T20:16:29.644Z","updated_at":"2026-01-31T21:23:44.901Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"sgiw9556","parent_id":null,"name":"Create initial CI setup","description":"Create a GitHub CI workflow that triggers on each push to main and runs `zig build test --summary all`","priority":1,"completed":true,"result":"Created GitHub Actions CI workflow at .github/workflows/ci.yaml that runs 'zig build test --summary all' on push to main, pull requests, and merge groups. Uses mlugg/setup-zig@v2 for Zig toolchain and ubuntu-latest runner.","metadata":{"commit":{"sha":"7d8b8ff226a0f7926794181575cf39a8830f3d95","message":"chore: add a task for CI","branch":"main","timestamp":"2026-01-31T21:04:44.561Z"},"github":{"issueNumber":6,"issueUrl":"https://github.com/unexge/rv/issues/6","repo":"unexge/rv","state":"open"}},"created_at":"2026-01-31T20:59:48.213Z","updated_at":"2026-01-31T21:23:44.902Z","started_at":"2026-01-31T21:04:44.565Z","completed_at":"2026-01-31T21:04:44.565Z","blockedBy":[],"blocks":[],"children":[]}
{"id":"t1_cursor","parent_id":"12ienxcq","name":"Add cursor movement tests","description":"Test cursor navigation in the TUI. Key scenarios:\n\n1. j/k or arrow keys move cursor up/down through diff lines\n2. Cursor skips non-selectable rows (separators marked with '...')\n3. Cursor stays within bounds [0, row_count-1]\n4. 'g' goes to first line, 'G' goes to last line\n5. Page up/down (f/p keys) moves by 20 lines\n6. Cursor movement works correctly in both split and unified view modes\n7. When in summary/collapse mode, cursor skips hidden (collapsed) lines\n\nUse TestRunner.sendChar() and verify cursor_line changes correctly. Test with various diff configurations: empty file, single line, many lines, files with separators between chunks.","priority":2,"completed":true,"result":"Added 14 cursor movement tests covering:\n- Arrow key navigation (up/down)  \n- Upper bound checking (can't go below 0)\n- Lower bound checking (can't exceed row_count - 1)\n- 'g' key jumps to first line\n- 'G' key jumps to last line\n- Skipping non-selectable separator rows\n- Page down ('f') moves by 20 lines\n- Page up ('p') moves by 20 lines\n- Page up at top stays at 0\n- Page down at bottom stays at last line\n- Movement with empty file (no crash)\n- Movement with single line file\n- Unified view mode navigation\n- Split view mode navigation\n\nAlso made handleKeyPress public in ui.zig and updated sendKey in TestRunner to call it directly.\n\nAll 96 tests pass.","metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T20:52:04.397Z","started_at":"2026-01-31T20:38:59.287Z","completed_at":"2026-01-31T20:52:04.397Z","blockedBy":[],"blocks":[],"children":[]}
{"id":"t10_integ","parent_id":"12ienxcq","name":"Add integration tests for user workflows","description":"Test complete user workflows end-to-end. Key scenarios:\n\n1. Review workflow: Open diff → navigate to change → add comment → export markdown\n2. Multi-file review: Switch between files → add comments on different files → verify all stored\n3. Collapse workflow: Start collapsed → expand specific function → add comment → collapse again\n4. Selection workflow: Navigate to line → start selection → extend selection → add multi-line comment\n5. View toggle workflow: Review in split view → toggle to unified → continue reviewing\n6. Search-like workflow: Use file list to jump to specific file → navigate to specific line\n7. Cancel workflow: Start comment → type text → escape → verify no comment created\n8. Focus side workflow: Review deletion (old side) → tab to old → add comment on old side\n\nThese simulate real user sessions. Chain multiple sendKey/sendChar calls and verify final state matches expected outcome.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t2_select","parent_id":"12ienxcq","name":"Add selection system tests","description":"Test the multi-line selection feature used for comments and ask context. Key scenarios:\n\n1. Space bar toggles selection_start at current cursor position\n2. Shift+Up/Down extends selection from selection_start\n3. Plain arrow movement (without shift) clears selection\n4. Selection persists while moving with shift held\n5. Escape clears selection\n6. Selection range correctly computed (min/max of selection_start and cursor_line)\n7. Selection works across different line types (additions, deletions, context)\n\nSelection is critical for the comment feature - comments use the selected line range. Verify selection_start field in UI state and that getSelectedRange() returns correct values.","priority":2,"completed":true,"result":"Added 10 selection system tests covering:\n- Space bar toggles selection_start at current position\n- Shift+Down extends selection downward\n- Shift+Up extends selection upward\n- Plain arrow movement (without shift) clears selection\n- Escape clears selection\n- Selection range min/max computation (when selection_start > cursor_line)\n- Shift+PageDown (f) starts/extends selection\n- Shift+PageUp (p) starts/extends selection\n- Selection persists while extending with shift held\n- Space bar at different cursor positions\n\nAlso added helper methods sendSpace(), sendShiftUp(), sendShiftDown() to TestRunner.\n\nAll 106 tests pass.","metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T20:53:47.612Z","started_at":"2026-01-31T20:52:13.991Z","completed_at":"2026-01-31T20:53:47.612Z","blockedBy":[],"blocks":[],"children":[]}
{"id":"t3_modes","parent_id":"12ienxcq","name":"Add mode transition tests","description":"Test transitions between UI modes (normal, comment_input, ask_input, help, file_list, ask_response). Key scenarios:\n\n1. 'c' from normal → comment_input mode\n2. 'a' from normal → ask_input mode\n3. '?' from normal → help mode\n4. 'l' or '.' from normal → file_list mode\n5. Escape from any mode → returns to normal (or previous mode for ask_response_comment)\n6. 'q' in normal mode sets should_quit flag\n7. Enter in comment_input submits and returns to normal\n8. Enter in file_list selects file and returns to normal\n\nVerify mode field in snapshot.state changes correctly. Each mode has different key handlers - ensure wrong keys are ignored in each mode.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t4_comment","parent_id":"12ienxcq","name":"Add comment submission tests","description":"Test the comment creation workflow. Key scenarios:\n\n1. Enter comment mode with 'c', type text, press Enter to submit\n2. Comment stored with correct file path (session.currentFile().path)\n3. Comment stored with correct side (focus_side: old or new)\n4. Comment stored with correct line range (from cursor/selection)\n5. Single line selection: line_start == line_end\n6. Multi-line selection: correct start/end from selection range\n7. Empty comment rejected (Enter with empty buffer does nothing)\n8. Escape cancels without creating comment\n9. Input buffer cleared after submission\n10. Tab toggles focus_side between old/new before commenting\n\nComments are stored in session.comments ArrayList. Verify comment count increases and comment fields are correct.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t5_views","parent_id":"12ienxcq","name":"Add view mode toggle tests","description":"Test split vs unified view mode switching. Key scenarios:\n\n1. Default view_mode is .split\n2. 'v' key toggles between split and unified\n3. Message displayed: 'Split view' or 'Unified view'\n4. Cursor position preserved across toggle\n5. Selection preserved across toggle\n6. Both modes render correctly for additions (green/+)\n7. Both modes render correctly for deletions (red/-)\n8. Both modes render correctly for modifications (both old and new shown)\n9. Split view shows left panel (old) and right panel (new)\n10. Unified view shows single panel with prefixes\n\nUse snapshot comparison to verify rendering differences between modes.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t6_collapse","parent_id":"12ienxcq","name":"Add collapse/summary mode tests","description":"Test the code folding/summary mode feature. Key scenarios:\n\n1. summary_mode defaults to true (collapsed)\n2. 's' key toggles summary_mode and all regions' collapsed state\n3. Message displayed: 'Summary mode (collapsed)' or 'Expanded view'\n4. Enter key on a region header toggles that specific region\n5. Collapsed regions hide body lines (lines after header_end_line)\n6. Header lines always visible\n7. Collapse indicators shown: ▶/▼ for level 1, ›/⌄ for level 2\n8. Cursor adjusts if it lands on a hidden line after collapse\n9. isLineVisible() returns false for collapsed body lines\n10. Navigation skips hidden lines\n\nCollapse regions are detected via tree-sitter for functions, structs, etc. Test with Zig code that has nested functions/structs.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t7_filelist","parent_id":"12ienxcq","name":"Add file list navigation tests","description":"Test the file list overlay for switching between files. Key scenarios:\n\n1. 'l' or '.' opens file_list mode\n2. file_list_cursor initialized to current file index\n3. Up/Down arrows move file_list_cursor within bounds\n4. Numeric keys 1-9 jump directly to that file (if exists)\n5. Enter selects file: sets current_file_idx, rebuilds diff lines, returns to normal\n6. Escape returns to normal without changing file\n7. 'l' or '.' in file_list mode also closes it\n8. Left/Right arrows in normal mode also switch files (prev/next)\n9. File switching clears scroll_offset and cursor_line\n10. File switching triggers buildDiffLines() for new file\n\nTest with session containing multiple files. Verify current_file_idx changes and diff content updates.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t8_render","parent_id":"12ienxcq","name":"Add rendering snapshot tests","description":"Test visual output using snapshot comparison. Key scenarios:\n\n1. Empty session shows '(no files)' in header\n2. File with only additions shows all lines with + prefix (unified) or right-only (split)\n3. File with only deletions shows all lines with - prefix (unified) or left-only (split)\n4. Header shows current file path and diff status\n5. Footer shows navigation hints and comment count\n6. Help screen displays all keybindings correctly\n7. File list overlay renders file names with selection highlight\n8. Error messages displayed in red/bold styling\n9. Cursor line highlighted (reverse video or similar)\n10. Selected lines highlighted differently from cursor\n11. Syntax highlighting colors applied to code\n12. Collapse indicators (▶▼) rendered at correct positions\n\nUse captureSnapshot() and compare text_rows and styles arrays. Create golden snapshots for reference.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
{"id":"t9_edge","parent_id":"12ienxcq","name":"Add edge case tests","description":"Test boundary conditions and unusual inputs. Key scenarios:\n\n1. Empty file (0 lines) - should render without crashing\n2. Single line file - cursor bounds, no scrolling needed\n3. Binary file (is_binary=true) - no diff lines generated\n4. Very long lines (>terminal width) - truncation or wrapping\n5. Unicode/UTF-8 content - proper character handling\n6. Terminal too small (<40 width or <5 height) - shows 'Terminal too small' message\n7. File with no changes (all context lines)\n8. File with only one type of change (all additions or all deletions)\n9. Very large file (1000+ lines) - scrolling and performance\n10. Many files in session (20+) - file list navigation\n11. Deep nesting in collapse regions (3+ levels)\n12. Input buffer at max capacity (4096 bytes)\n\nThese tests ensure robustness. Use TestRunner with various extreme configurations.","priority":2,"completed":false,"result":null,"metadata":null,"created_at":"2026-01-31T21:00:00.000Z","updated_at":"2026-01-31T21:00:00.000Z","started_at":null,"completed_at":null,"blockedBy":[],"blocks":[],"children":[]}
